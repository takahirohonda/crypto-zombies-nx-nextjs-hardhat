# Lesson 1: Making the zombie factory

## Latest code

There is an outdated method used in the tutorial. The `push` function for dynamic array no longer returns the new length of the array after `Solidity 0.6.0`.

```solidity
uint id = zombies.push(Zombie(_name, _dna)) - 1
```

Instead, we need to use:

```solidity
uint id = zombies.length;
```

## 6. array & state variables

`State variables` are stored permanently in the blockchain. So creating a dynamic array of structs like this can be useful for storing structured data in your contract, kind of like a database.

You can declare an array as public, and Solidity will automatically create a getter method for it. The syntax looks like:

`Person[] public people;`

Other contracts would then be able to read from, but not write to, this array. So this is a useful pattern for storing public data in your contract.

Examples of fixed and dynamic arrays. Solidity has 2 types of arrays, fixed and dynamic.

```solidity
// Array with a fixed length of 2 elements:
uint[2] fixedArray;
// another fixed Array, can contain 5 strings:
string[5] stringArray;
// a dynamic Array - has no fixed size, can keep growing:
uint[] dynamicArray;
```

## 3. state variables & uint in Solidity

`State variables` are permanently stored in contract storage. They are written to the Ethereum blockchain. Hence, it works like storing value in the data base.

```solidity
contract Example {
  // This will be stored permanently in the blockchain
  uint myUnsignedInteger = 100;
}
```

In Solidity, uint is actually an alias for uint256, a 256-bit unsigned integer. You can declare uints with less bits â€” uint8, uint16, uint32, etc.. But in general you want to simply use uint except in specific cases.

## 1. Zombie DNA

Zombie DNA is a 16-digit integer.

`8356281049284737`

First 2 digits represents 7 types of head. Get the head type

**Answer**

`83 % 7 + 1 = 7`, hence it's type 7.

**More details regarding the modulus operation**

`a mod n =r`

- `a` is the dividend
- `n` is the divisor (modulus)
- `r` is the reminder (or the result of the modulo operation)

`%` = `modulo operator`

In programming, people sometimes loosely say `modulus` to mean the reminder, which can cause confusion. Technically, the modulus is the divisor and the reminder is the result in modular arithmetic.

**Chapter 9**

In the `createZombie` method, push a newly created zombie to and zombies array.

```solidity
contract ZombieFactory {
    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function createZombie(string memory _name, uint _dna) public {
        // push a newly created zombie into an array...
    }

}

```

Answer

```solidity
zombies.push(Zombie(_name, _dna))
```

**Chapter 10 & 11**

Create `_generateRandomDna` that takes `_str` as string and return a `uint`. Use `keccack256` with converting the zombie name by packing the string to a byte type. `keccack256` only takes the byte type as an argument.

Answer

```solidity
// view -> this function view some of our contract's variables but not modifying them.
function _generateRandomDna(string memory _str) private view returns (uint) {
    // encodedPacked method will convert string to byte. This is not secure because it depends on the zombie name.
    uint rand = uint(keccak256(abi.encodePacked(_str)));
    return rand % dnaModulus; // this will ensure the DNA only has 16 digits.
  }
```

**Chapter 13**

Add zombie created event.

## Function examples

```solidity
string greeting = "What's up dog";

function sayHello() public returns (string memory) {
  return greeting;
}
```

`pure` function means the solidity is not accessing any data in the app.

```solidity
function _multiply(uint a, uint b) private pure returns (uint) {
  return a * b;
}
```

## Event examples

Events are a way for your contract to communicate that something happened on the blockchain on your app to the frontend.

```solidity
// declare the event
event IntegersAdded(uint x, uint y, uint result);

function add(uint _x, uint _y) public returns (uint) {
  emit IntegersAdded(_x, _y, result);
  return result;
}
```

---

## Frontend code example with web3.js

```js
var abi = /* abi generated by the compiler */
var ZombieFactoryContract = web3.eth.contract(abi)
var contractAddress = /* our contract address on Ethereum after deploying */
var ZombieFactory = ZombieFactoryContract.at(contractAddress)
// `ZombieFactory` has access to our contract's public functions and events

// some sort of event listener to take the text input:
$("#ourButton").click(function(e) {
  var name = $("#nameInput").val()
  // Call our contract's `createRandomZombie` function:
  ZombieFactory.createRandomZombie(name)
})

// Listen for the `NewZombie` event, and update the UI
var event = ZombieFactory.NewZombie(function(error, result) {
  if (error) return
  generateZombie(result.zombieId, result.name, result.dna)
})

// take the Zombie dna, and update our image
function generateZombie(id, name, dna) {
  let dnaStr = String(dna)
  // pad DNA with leading zeroes if it's less than 16 characters
  while (dnaStr.length < 16)
    dnaStr = "0" + dnaStr

  let zombieDetails = {
    // first 2 digits make up the head. We have 7 possible heads, so % 7
    // to get a number 0 - 6, then add 1 to make it 1 - 7. Then we have 7
    // image files named "head1.png" through "head7.png" we load based on
    // this number:
    headChoice: dnaStr.substring(0, 2) % 7 + 1,
    // 2nd 2 digits make up the eyes, 11 variations:
    eyeChoice: dnaStr.substring(2, 4) % 11 + 1,
    // 6 variations of shirts:
    shirtChoice: dnaStr.substring(4, 6) % 6 + 1,
    // last 6 digits control color. Updated using CSS filter: hue-rotate
    // which has 360 degrees:
    skinColorChoice: parseInt(dnaStr.substring(6, 8) / 100 * 360),
    eyeColorChoice: parseInt(dnaStr.substring(8, 10) / 100 * 360),
    clothesColorChoice: parseInt(dnaStr.substring(10, 12) / 100 * 360),
    zombieName: name,
    zombieDescription: "A Level 1 CryptoZombie",
  }
  return zombieDetails
}
```
